<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Login - CIANET PROVEDOR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body style="margin:0; padding:0; min-height:100vh; display:flex; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:linear-gradient(135deg,#166534 0%,#22c55e 50%,#f97316 100%); background-size:400% 400%; animation:bg 15s ease infinite;">
<style>
@keyframes bg{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
@keyframes float{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-20px) rotate(5deg)}}
.shape{position:absolute;border-radius:50%;opacity:0.15;animation:float 6s ease-in-out infinite}
</style>

<!-- Formas flutuantes -->
<div class="shape" style="width:300px;height:300px;background:#22c55e;top:-50px;left:-50px;animation-delay:0s"></div>
<div class="shape" style="width:200px;height:200px;background:#f97316;top:20%;right:-30px;animation-delay:1s"></div>
<div class="shape" style="width:250px;height:250px;background:#4ade80;bottom:-50px;left:30%;animation-delay:2s"></div>
<div class="shape" style="width:180px;height:180px;background:#fb923c;bottom:20%;right:20%;animation-delay:3s"></div>

<!-- Container principal -->
<div style="flex:1;display:flex;align-items:center;justify-content:center;padding:20px;position:relative;z-index:10">
    <div style="width:100%;max-width:440px;background:rgba(255,255,255,0.95);border-radius:28px;box-shadow:0 25px 60px rgba(0,0,0,0.3);overflow:hidden;backdrop-filter:blur(20px)">
        
        <!-- Header verde/laranja -->
        <div style="background:linear-gradient(135deg,#166534,#22c55e,#f97316);padding:40px 32px;text-align:center">
            <div style="width:80px;height:80px;background:rgba(255,255,255,0.2);border-radius:24px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:36px;color:white;backdrop-filter:blur(10px)">
                <i class="bi bi-headset"></i>
            </div>
            <h1 style="color:white;font-size:28px;font-weight:700;margin:0 0 8px 0">CIANET PROVEDOR</h1>
            <p style="color:rgba(255,255,255,0.9);font-size:15px;margin:0">Sistema de Atendimento Inteligente</p>
        </div>
        
        <!-- Corpo do formulário -->
        <div style="padding:36px 32px">
            <!-- Badge WhatsApp -->
            <div style="display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 20px;background:linear-gradient(135deg,#dcfce7,#bbf7d0);border-radius:12px;margin-bottom:28px">
                <i class="bi bi-whatsapp" style="color:#16a34a;font-size:20px"></i>
                <span style="color:#166534;font-size:14px;font-weight:600">Integrado com WhatsApp Business</span>
            </div>
            
            <!-- Formulário -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div style="margin-bottom:20px">
                    <label style="display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:#374151;margin-bottom:10px">
                        <i class="bi bi-envelope" style="color:#22c55e"></i> Email
                    </label>
                    <input type="email" id="email" required placeholder="seu@email.com" 
                        style="width:100%;padding:16px 20px;border:2px solid #e5e7eb;border-radius:14px;font-size:15px;box-sizing:border-box;transition:all 0.3s"
                        onfocus="this.style.borderColor='#22c55e';this.style.boxShadow='0 0 0 4px rgba(34,197,94,0.15)'"
                        onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">
                </div>
                
                <div style="margin-bottom:24px">
                    <label style="display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:#374151;margin-bottom:10px">
                        <i class="bi bi-lock" style="color:#22c55e"></i> Senha
                    </label>
                    <div style="position:relative">
                        <input type="password" id="password" required placeholder="********" 
                            style="width:100%;padding:16px 50px 16px 20px;border:2px solid #e5e7eb;border-radius:14px;font-size:15px;box-sizing:border-box;transition:all 0.3s"
                            onfocus="this.style.borderColor='#22c55e';this.style.boxShadow='0 0 0 4px rgba(34,197,94,0.15)'"
                            onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">
                        <button type="button" onclick="togglePassword()" 
                            style="position:absolute;right:16px;top:50%;transform:translateY(-50%);background:none;border:none;color:#9ca3af;cursor:pointer;font-size:18px">
                            <i class="bi bi-eye" id="eyeIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-size:14px;color:#6b7280">
                        <input type="checkbox" id="remember" style="width:18px;height:18px;accent-color:#22c55e">
                        Manter conectado
                    </label>
                    <a href="#" style="color:#f97316;font-size:14px;text-decoration:none;font-weight:500">Esqueceu a senha?</a>
                </div>
                
                <button type="submit" id="submitBtn"
                    style="width:100%;padding:18px;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;border:none;border-radius:14px;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s"
                    onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 15px 35px rgba(34,197,94,0.4)'"
                    onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
                    <i class="bi bi-box-arrow-in-right"></i>
                    Entrar no Sistema
                </button>
            </form>
            
            <!-- Demo box -->
            <div style="margin-top:28px;padding:20px;background:linear-gradient(135deg,#fff7ed,#ffedd5);border:2px solid #fed7aa;border-radius:16px">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
                    <i class="bi bi-info-circle-fill" style="color:#f97316;font-size:20px"></i>
                    <span style="font-weight:700;color:#c2410c">Credenciais de Demonstração</span>
                </div>
                <div style="font-size:14px;color:#9a3412">
                    <div style="margin-bottom:6px"><strong>Email:</strong> admin@empresa.com.br</div>
                    <div><strong>Senha:</strong> Admin@123</div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div style="padding:20px;text-align:center;border-top:1px solid #f4f4f5">
            <p style="color:#9ca3af;font-size:13px;margin:0">© 2026 CIANET PROVEDOR v3.0</p>
        </div>
    </div>
</div>

<!-- Mensagem de erro -->
<div id="errorMsg" style="display:none;position:fixed;top:20px;right:20px;padding:16px 24px;background:#fef2f2;border:2px solid #fecaca;border-radius:12px;color:#dc2626;font-weight:500;z-index:1000">
    <i class="bi bi-exclamation-circle"></i> <span id="errorText"></span>
</div>

<script>
function togglePassword() {
    const pwd = document.getElementById('password');
    const icon = document.getElementById('eyeIcon');
    if (pwd.type === 'password') {
        pwd.type = 'text';
        icon.className = 'bi bi-eye-slash';
    } else {
        pwd.type = 'password';
        icon.className = 'bi bi-eye';
    }
}

function showError(msg) {
    document.getElementById('errorText').textContent = msg;
    document.getElementById('errorMsg').style.display = 'block';
    setTimeout(() => document.getElementById('errorMsg').style.display = 'none', 4000);
}

async function handleLogin(e) {
    e.preventDefault();
    const btn = document.getElementById('submitBtn');
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    btn.innerHTML = '<i class="bi bi-arrow-repeat" style="animation:spin 1s linear infinite"></i> Entrando...';
    btn.disabled = true;
    
    try {
        const res = await fetch('/api/v1/auth/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, password })
        });
        
        const data = await res.json();
        
        if (res.ok && data.access_token) {
            const storage = document.getElementById('remember').checked ? localStorage : sessionStorage;
            storage.setItem('access_token', data.access_token);
            storage.setItem('user', JSON.stringify(data.user || {nome: 'Admin'}));
            window.location.href = '/dashboard';
        } else {
            showError(data.detail || 'Email ou senha inválidos');
        }
    } catch (err) {
        showError('Erro de conexão. Tente novamente.');
    }
    
    btn.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> Entrar no Sistema';
    btn.disabled = false;
}
</script>
<style>@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}</style>
</body>
</html>
